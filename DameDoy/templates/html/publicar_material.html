{% extends 'html/base.html' %}
{% load static %}

{% block title %}Publicar Material{% endblock %}

{% block styles %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'css/publicar_material.css' %}">
{% endblock %}

{% block content %}
<div class="publicar-container">
    <h1>Publicar Nuevo Material</h1>
    
    <form method="post" enctype="multipart/form-data" class="material-form" id="formMaterial">
        {% csrf_token %}
        
        {% if messages %}
        <div class="alert alert-error">
            {% for message in messages %}
            <div>{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="form-grid">
            <div class="form-group">
                <label for="titulo">Título <span class="required">*</span></label>
                <input type="text" 
                       id="titulo" 
                       name="titulo" 
                       class="form-control"
                       required 
                       minlength="3"
                       maxlength="200"
                       placeholder="Ingresa el título del material">
            </div>

            <div class="form-group">
                <label for="tipo">Tipo de Material <span class="required">*</span></label>
                <select id="tipo" 
                        name="tipo" 
                        class="form-control"
                        required>
                    <option value="">Selecciona un tipo</option>
                    <option value="apunte">Apunte</option>
                    <option value="examen">Examen</option>
                    <option value="proyecto">Proyecto</option>
                    <option value="libro">Libro</option>
                    <option value="otros">Otros</option>
                </select>
            </div>

            <div class="form-group">
                <label for="universidad">Universidad <span class="required">*</span></label>
                <select id="universidad" name="universidad" class="select2" required>
                    <option value="">Seleccione una universidad</option>
                    {% for univ in universidades %}
                        <option value="{{ univ.id }}">{{ univ.siglas }} - {{ univ.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="facultad">Facultad <span class="required">*</span></label>
                <select id="facultad" name="facultad" class="select2" required disabled>
                    <option value="">Primero seleccione una universidad</option>
                </select>
            </div>

            <div class="form-group">
                <label for="carrera">Carrera <span class="required">*</span></label>
                <select id="carrera" name="carrera" class="select2" required disabled>
                    <option value="">Primero seleccione una facultad</option>
                </select>
            </div>

            <div class="form-group">
                <label for="materia">Materia <span class="required">*</span></label>
                <select id="materia" name="materia" class="select2" required disabled>
                    <option value="">Primero seleccione una carrera</option>
                </select>
            </div>

            <div class="form-group">
                <label for="docente">Docente <span class="required">*</span></label>
                <select id="docente" name="docente" class="select2" required disabled>
                    <option value="">Primero seleccione una materia</option>
                </select>
            </div>
            <div class="form-group">
                <label for="precio">Precio <span class="required">*</span></label>
                <input type="number" 
                       id="precio" 
                       name="precio" 
                       class="form-control"
                       required 
                       min="0" 
                       step="0.01"
                       placeholder="0.00">
            </div>
            <div class="form-group full-width">
                <label for="descripcion">Descripción <span class="required">*</span></label>
                <textarea id="descripcion" 
                          name="descripcion" 
                          class="form-control"
                          required 
                          rows="4"
                          minlength="10"
                          placeholder="Describe el contenido del material"></textarea>
            </div>
            <!-- Este div es para la imagen del material -->
            <div class="form-group file-input">
                <label for="imagen">Imagen del Material <span class="required">*</span></label>
                <div class="imagen-preview" id="imagenPreview"></div>
                <input type="file" 
                       id="imagen" 
                       name="imagen" 
                       class="form-control"
                       required 
                       accept="image/*">
                <small class="help-text">Formatos permitidos: JPG, PNG. Máximo 5MB</small>
            </div>
            <!-- Este div es para los archivos del material: -->
            <div class="form-group file-input">
                <label for="archivos">Archivos del Material</label>
                <div class="archivos-container">
                    <div class="archivos-dropzone" id="archivosDropzone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Arrastra tus archivos aquí o</p>
                        <label class="btn-upload">
                            <span>Seleccionar archivos</span>
                            <input type="file" 
                                id="archivos" 
                                name="archivos" 
                                multiple
                                accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.zip,.rar,.txt"
                                style="display: none;">
                        </label>
                    </div>
                </div>
                <small class="help-text">
                    Formatos permitidos: PDF, Word, Excel, PowerPoint, ZIP, RAR, TXT. Máximo 50MB por archivo.
                </small>
            </div>
            <!-- Aqui se previsualizarán los archivos subidos: -->
            <div id="archivos-preview" class="archivos-preview"></div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn-publicar">
                <i class="fas fa-paper-plane"></i> Publicar Material
            </button>
            <a href="{% url 'lista_materiales' %}" class="btn-cancelar">
                <i class="fas fa-times"></i> Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'js/publicar_material.js' %}"></script>
{% endblock %}